generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AccountLockout {
  id         String    @id
  identifier String    @unique
  reason     String
  lockedAt   DateTime  @default(now())
  expiresAt  DateTime
  unlocked   Boolean   @default(false)
  unlockedAt DateTime?

  @@index([expiresAt])
  @@index([identifier])
  @@index([unlocked])
}

model AnalyticsEvent {
  id        String   @id
  userId    String?
  sessionId String
  eventType String
  eventData Json
  timestamp DateTime @default(now())
  userAgent String
  ipAddress String

  @@index([eventType])
  @@index([timestamp])
  @@index([userId])
}

model CardTransaction {
  id            String       @id
  userId        String?
  fictiveCardId String?
  testCardId    String?
  orderId       String?      @unique
  amount        Float
  type          String
  status        String       @default("COMPLETED")
  cardLast4     String?
  cardType      String?
  description   String?
  createdAt     DateTime     @default(now())
  FictiveCard   FictiveCard? @relation(fields: [fictiveCardId], references: [id])
  Order         Order?       @relation(fields: [orderId], references: [id])
  TestCard      TestCard?    @relation(fields: [testCardId], references: [id])
  User          User?        @relation(fields: [userId], references: [id])

  @@index([fictiveCardId])
  @@index([orderId])
  @@index([testCardId])
  @@index([userId])
}

model CarouselItem {
  id                  String    @id
  type                String
  position            Int
  productId           String?
  mediaId             String?
  title               String?
  description         String?
  imageUrl            String?
  linkUrl             String?
  isActive            Boolean   @default(true)
  startDate           DateTime?
  endDate             DateTime?
  createdById         String
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  customDescription   String?
  customTitle         String?
  textStyle           Json?
  customDescriptionDe String?
  customDescriptionEn String?
  customDescriptionEs String?
  customDescriptionFr String?
  customDescriptionIt String?
  customTitleDe       String?
  customTitleEn       String?
  customTitleEs       String?
  customTitleFr       String?
  customTitleIt       String?
  User                User      @relation(fields: [createdById], references: [id], onDelete: Cascade)
  Media               Media?    @relation(fields: [mediaId], references: [id])
  DataItem            DataItem? @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([isActive])
  @@index([mediaId])
  @@index([position])
  @@index([productId])
  @@index([type])
}

model CartItem {
  id         String    @id
  userId     String
  dataItemId String
  quantity   Float     @default(1)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  giftRuleId String?
  isGift     Boolean   @default(false)
  dataItem   DataItem  @relation(fields: [dataItemId], references: [id], onDelete: Cascade)
  giftRule   GiftRule? @relation(fields: [giftRuleId], references: [id])
  User       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, dataItemId, isGift])
  @@index([giftRuleId])
  @@index([isGift])
  @@index([userId])
}

model Category {
  id             String          @id
  name           String          @unique
  slug           String          @unique
  nameRo         String?
  nameEn         String?
  icon           String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  isActive       Boolean         @default(true)
  parentId       String?
  position       Int             @default(0)
  description    String?
  nameDe         String?
  nameEs         String?
  nameFr         String?
  nameIt         String?
  Category       Category?       @relation("CategoryToCategory", fields: [parentId], references: [id], onDelete: Cascade)
  other_Category Category[]      @relation("CategoryToCategory")
  DataItem       DataItem[]
  GiftCondition  GiftCondition[]

  @@index([isActive])
  @@index([parentId])
  @@index([position])
  @@index([slug])
}

model ChatMessage {
  id              String            @id
  chatRoomId      String
  senderId        String
  content         String
  type            String            @default("TEXT")
  fileUrl         String?
  fileName        String?
  isEdited        Boolean           @default(false)
  editedAt        DateTime?
  isDeleted       Boolean           @default(false)
  deletedAt       DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  ChatRoom        ChatRoom          @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)
  User            User              @relation(fields: [senderId], references: [id], onDelete: Cascade)
  ChatMessageRead ChatMessageRead[]

  @@index([chatRoomId])
  @@index([createdAt])
  @@index([isDeleted])
  @@index([senderId])
}

model ChatMessageRead {
  id          String      @id
  messageId   String
  userId      String
  readAt      DateTime    @default(now())
  ChatMessage ChatMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@index([messageId])
  @@index([userId])
}

model ChatRoom {
  id             String           @id
  name           String?
  description    String?
  type           String           @default("DIRECT")
  isActive       Boolean          @default(true)
  createdById    String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  ChatMessage    ChatMessage[]
  User           User             @relation(fields: [createdById], references: [id], onDelete: Cascade)
  ChatRoomMember ChatRoomMember[]

  @@index([createdById])
  @@index([isActive])
  @@index([type])
}

model ChatRoomMember {
  id         String    @id
  chatRoomId String
  userId     String
  role       String    @default("MEMBER")
  joinedAt   DateTime  @default(now())
  leftAt     DateTime?
  isActive   Boolean   @default(true)
  ChatRoom   ChatRoom  @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)
  User       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([chatRoomId, userId])
  @@index([chatRoomId])
  @@index([isActive])
  @@index([userId])
}

model Currency {
  id                                                 String         @id
  code                                               String         @unique
  name                                               String
  symbol                                             String
  isBase                                             Boolean        @default(false)
  isActive                                           Boolean        @default(true)
  position                                           String         @default("before")
  decimals                                           Int            @default(2)
  createdAt                                          DateTime       @default(now())
  updatedAt                                          DateTime
  ExchangeRate_ExchangeRate_fromCurrencyIdToCurrency ExchangeRate[] @relation("ExchangeRate_fromCurrencyIdToCurrency")
  ExchangeRate_ExchangeRate_toCurrencyIdToCurrency   ExchangeRate[] @relation("ExchangeRate_toCurrencyIdToCurrency")

  @@index([code])
  @@index([isActive])
  @@index([isBase])
}

model DataItem {
  id                    String              @id
  title                 String
  description           String?
  content               String
  price                 Float
  oldPrice              Float?
  stock                 Float               @default(0)
  image                 String
  status                String              @default("draft")
  userId                String
  createdAt             DateTime            @default(now())
  updatedAt             DateTime
  rating                Float               @default(0)
  categoryId            String
  isInStock             Boolean             @default(true)
  lowStockAlert         Float               @default(5)
  trackInventory        Boolean             @default(true)
  availabilitySchedule  String?
  availabilityType      String              @default("always")
  advanceOrderDays      Int                 @default(0)
  advanceOrderHours     Int                 @default(0)
  allowFractional       Boolean             @default(false)
  availableDeliveryDays String?
  availableQuantities   String?
  availableStock        Float               @default(0)
  consumeBeforeNote     String?
  customDeliveryRules   Boolean             @default(false)
  deliveryTimeDays      Int?
  deliveryTimeHours     Int?
  expiryDate            DateTime?
  isPerishable          Boolean             @default(false)
  lastRestockDate       DateTime?
  maxQuantity           Float?
  minQuantity           Float               @default(1)
  productionDate        DateTime?
  quantityStep          Float               @default(1)
  requiresAdvanceOrder  Boolean             @default(false)
  reservedStock         Float               @default(0)
  restockAlert          Boolean             @default(false)
  shelfLifeDays         Int?
  specialHandling       String?
  storageInstructions   String?
  totalOrdered          Float               @default(0)
  totalSold             Float               @default(0)
  unitName              String              @default("bucată")
  unitType              String              @default("piece")
  warrantyDays          Int?
  carouselOrder         Int                 @default(0)
  showInCarousel        Boolean             @default(false)
  priceType             String              @default("per_unit")
  stockDisplayMode      String              @default("visible")
  importantInfo         String?
  contentEn             String?
  descriptionEn         String?
  titleEn               String?
  contentDe             String?
  contentEs             String?
  contentFr             String?
  contentIt             String?
  descriptionDe         String?
  descriptionEs         String?
  descriptionFr         String?
  descriptionIt         String?
  titleDe               String?
  titleEs               String?
  titleFr               String?
  titleIt               String?
  CarouselItem          CarouselItem[]
  CartItem              CartItem[]
  category              Category            @relation(fields: [categoryId], references: [id])
  User                  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  Favorite              Favorite[]
  GiftCondition         GiftCondition[]
  GiftProduct           GiftProduct[]
  GiftRuleUsage         GiftRuleUsage[]
  NavigationHistory     NavigationHistory[]
  OrderItem             OrderItem[]
  ProductOffer          ProductOffer[]
  reviews               Review[]
  StockMovement         StockMovement[]

  @@index([availabilityType])
  @@index([categoryId])
  @@index([isPerishable])
  @@index([requiresAdvanceOrder])
  @@index([status])
  @@index([userId])
}

model DeliveryLocation {
  id                    String            @id
  name                  String
  address               String
  city                  String
  postalCode            String?
  country               String            @default("România")
  coordinates           String?
  phone                 String?
  email                 String?
  isActive              Boolean           @default(true)
  deliveryRadius        Float?
  deliveryFee           Float             @default(0)
  freeDeliveryThreshold Float?
  workingHours          String?
  specialInstructions   String?
  contactPerson         String?
  isMainLocation        Boolean           @default(false)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  deliveryMethodId      String?
  latitude              Float?
  longitude             Float?
  showRadiusOnMap       Boolean           @default(true)
  county                String?
  street                String?
  streetNumber          String?
  nameEn                String?
  nameIt                String?
  specialInstructionsEn String?
  specialInstructionsIt String?
  nameDe                String?
  nameEs                String?
  nameFr                String?
  specialInstructionsDe String?
  specialInstructionsEs String?
  specialInstructionsFr String?
  DeliverySettings      DeliverySettings? @relation(fields: [deliveryMethodId], references: [id])
  Order                 Order[]

  @@index([city])
  @@index([deliveryMethodId])
  @@index([isActive])
  @@index([isMainLocation])
}

model DeliverySettings {
  id                    String             @id
  name                  String             @unique
  isActive              Boolean            @default(true)
  deliveryTimeHours     Int?
  deliveryTimeDays      Int?
  availableDeliveryDays String?
  deliveryAreas         String?
  minimumOrderValue     Float?
  deliveryCost          Float              @default(0)
  freeDeliveryThreshold Float?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime
  type                  String             @default("courier")
  DeliveryLocation      DeliveryLocation[]

  @@index([isActive])
  @@index([type])
}

model ExchangeRate {
  id                                             String   @id
  fromCurrencyId                                 String
  toCurrencyId                                   String
  rate                                           Float
  source                                         String   @default("manual")
  lastUpdated                                    DateTime @default(now())
  createdAt                                      DateTime @default(now())
  Currency_ExchangeRate_fromCurrencyIdToCurrency Currency @relation("ExchangeRate_fromCurrencyIdToCurrency", fields: [fromCurrencyId], references: [id], onDelete: Cascade)
  Currency_ExchangeRate_toCurrencyIdToCurrency   Currency @relation("ExchangeRate_toCurrencyIdToCurrency", fields: [toCurrencyId], references: [id], onDelete: Cascade)

  @@unique([fromCurrencyId, toCurrencyId])
  @@index([fromCurrencyId])
  @@index([lastUpdated])
  @@index([toCurrencyId])
}

model ExchangeRateHistory {
  id           String   @id
  fromCurrency String
  toCurrency   String
  rate         Float
  source       String   @default("manual")
  recordedAt   DateTime @default(now())

  @@index([fromCurrency, toCurrency])
  @@index([recordedAt])
}

model Favorite {
  id         String   @id
  userId     String
  dataItemId String
  createdAt  DateTime @default(now())
  DataItem   DataItem @relation(fields: [dataItemId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, dataItemId])
  @@index([userId])
}

model FictiveCard {
  id              String            @id
  cardNumber      String            @unique
  cardHolder      String
  expiryMonth     Int
  expiryYear      Int
  cvv             String
  balance         Float             @default(1000.0)
  cardType        String            @default("VISA")
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  CardTransaction CardTransaction[]

  @@index([cardNumber])
}

model GiftCondition {
  id                  String          @id
  giftRuleId          String
  type                String
  minAmount           Float?
  productId           String?
  minQuantity         Int?            @default(1)
  categoryId          String?
  minCategoryAmount   Float?
  parentConditionId   String?
  logic               String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  Category            Category?       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  GiftRule            GiftRule        @relation(fields: [giftRuleId], references: [id], onDelete: Cascade)
  GiftCondition       GiftCondition?  @relation("GiftConditionToGiftCondition", fields: [parentConditionId], references: [id], onDelete: Cascade)
  other_GiftCondition GiftCondition[] @relation("GiftConditionToGiftCondition")
  DataItem            DataItem?       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([giftRuleId])
  @@index([parentConditionId])
  @@index([productId])
  @@index([type])
}

model GiftProduct {
  id                  String   @id
  giftRuleId          String
  productId           String
  maxQuantityPerOrder Int      @default(1)
  remainingStock      Int?
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  GiftRule            GiftRule @relation(fields: [giftRuleId], references: [id], onDelete: Cascade)
  DataItem            DataItem @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([giftRuleId, productId])
  @@index([giftRuleId])
  @@index([productId])
}

model GiftRule {
  id                 String          @id
  name               String
  description        String?
  isActive           Boolean         @default(true)
  priority           Int             @default(50)
  conditionLogic     String          @default("AND")
  maxUsesPerCustomer Int?
  maxTotalUses       Int?
  currentTotalUses   Int             @default(0)
  validFrom          DateTime?
  validUntil         DateTime?
  createdById        String
  createdAt          DateTime        @default(now())
  updatedAt          DateTime
  descriptionDe      String?
  descriptionEn      String?
  descriptionEs      String?
  descriptionFr      String?
  descriptionIt      String?
  nameDe             String?
  nameEn             String?
  nameEs             String?
  nameFr             String?
  nameIt             String?
  CartItem           CartItem[]
  GiftCondition      GiftCondition[]
  GiftProduct        GiftProduct[]
  User               User            @relation(fields: [createdById], references: [id], onDelete: Cascade)
  GiftRuleUsage      GiftRuleUsage[]
  OrderItem          OrderItem[]

  @@index([createdById])
  @@index([isActive])
  @@index([priority])
  @@index([validFrom])
  @@index([validUntil])
}

model GiftRuleUsage {
  id         String   @id
  giftRuleId String
  userId     String
  orderId    String
  productId  String
  usedAt     DateTime @default(now())
  GiftRule   GiftRule @relation(fields: [giftRuleId], references: [id], onDelete: Cascade)
  Order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  DataItem   DataItem @relation(fields: [productId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([giftRuleId])
  @@index([orderId])
  @@index([usedAt])
  @@index([userId])
}

model Media {
  id           String         @id
  filename     String
  originalName String
  path         String
  url          String
  mimeType     String
  size         Int
  width        Int?
  height       Int?
  title        String?
  description  String?
  altText      String?
  category     String?
  tags         String?
  usedOnPages  String?
  usageCount   Int            @default(0)
  displaySize  String?
  position     String?
  uploadedById String
  uploadedBy   String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  CarouselItem CarouselItem[]

  @@index([category])
  @@index([createdAt])
  @@index([mimeType])
  @@index([uploadedById])
}

model NavigationHistory {
  id         String   @id
  userId     String
  dataItemId String
  viewedAt   DateTime @default(now())
  DataItem   DataItem @relation(fields: [dataItemId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([dataItemId])
  @@index([userId, viewedAt])
}

model Notification {
  id        String   @id
  userId    String
  type      String
  title     String
  message   String
  data      Json?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([read])
  @@index([userId])
}

model Offer {
  id           String         @id
  title        String
  description  String
  image        String
  discount     Float
  validFrom    DateTime       @default(now())
  validUntil   DateTime
  active       Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  createdById  String?
  ProductOffer ProductOffer[]

  @@index([active])
  @@index([validFrom])
  @@index([validUntil])
}

model Order {
  id                 String            @id
  userId             String
  total              Float
  status             String            @default("PROCESSING")
  shippingAddress    String
  createdAt          DateTime          @default(now())
  updatedAt          DateTime
  deliveryName       String?
  deliveryPhone      String?
  paymentMethod      String            @default("cash")
  deliveryMethod     String            @default("courier")
  discount           Float             @default(0)
  invoiceGenerated   Boolean           @default(false)
  invoiceNumber      String?           @unique
  shippingCost       Float             @default(0)
  subtotal           Float?
  tax                Float             @default(0)
  orderLocalTime     String?
  orderLocation      String?
  orderTimezone      String?
  deliveryLocationId String?
  CardTransaction    CardTransaction?
  GiftRuleUsage      GiftRuleUsage[]
  DeliveryLocation   DeliveryLocation? @relation(fields: [deliveryLocationId], references: [id])
  user               User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderItems         OrderItem[]
  UserVoucher        UserVoucher?

  @@index([deliveryLocationId])
  @@index([invoiceNumber])
  @@index([status])
  @@index([userId])
}

model OrderItem {
  id            String    @id
  orderId       String
  dataItemId    String
  quantity      Float
  price         Float
  giftRuleId    String?
  isGift        Boolean   @default(false)
  originalPrice Float?
  dataItem      DataItem  @relation(fields: [dataItemId], references: [id], onDelete: Cascade)
  GiftRule      GiftRule? @relation(fields: [giftRuleId], references: [id])
  Order         Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([giftRuleId])
  @@index([isGift])
  @@index([orderId])
}

model Page {
  id              String        @id
  slug            String        @unique
  title           String
  content         String
  metaTitle       String?
  metaDescription String?
  isPublished     Boolean       @default(false)
  template        String        @default("default")
  createdById     String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  User            User          @relation(fields: [createdById], references: [id], onDelete: Cascade)
  PageSection     PageSection[]

  @@index([createdById])
  @@index([isPublished])
  @@index([slug])
}

model PageSection {
  id        String   @id
  pageId    String
  type      String
  title     String?
  content   String?
  settings  String?
  position  Int      @default(0)
  isVisible Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
  Page      Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([isVisible])
  @@index([pageId])
  @@index([position])
}

model PaymentMethod {
  id            String   @id
  name          String   @unique
  type          String
  isActive      Boolean  @default(true)
  description   String?
  icon          String?
  settings      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  descriptionDe String?
  descriptionEn String?
  descriptionEs String?
  descriptionFr String?
  descriptionIt String?
  nameDe        String?
  nameEn        String?
  nameEs        String?
  nameFr        String?
  nameIt        String?

  @@index([isActive])
  @@index([type])
}

model PendingUser {
  id        String   @id
  email     String   @unique
  password  String
  name      String
  phone     String?
  createdAt DateTime @default(now())
  expiresAt DateTime

  @@index([email])
  @@index([expiresAt])
}

model ProductOffer {
  id         String   @id
  dataItemId String
  offerId    String
  createdAt  DateTime @default(now())
  DataItem   DataItem @relation(fields: [dataItemId], references: [id], onDelete: Cascade)
  Offer      Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@unique([dataItemId, offerId])
  @@index([dataItemId])
  @@index([offerId])
}

model RateLimitAttempt {
  id          String   @id
  identifier  String   @unique
  attempts    Int      @default(1)
  windowStart DateTime @default(now())
  expiresAt   DateTime

  @@index([expiresAt])
  @@index([identifier])
}

model Review {
  id         String   @id
  rating     Int
  comment    String
  userId     String
  dataItemId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  DataItem   DataItem @relation(fields: [dataItemId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, dataItemId])
  @@index([dataItemId])
}

model SavedCard {
  id          String   @id
  userId      String
  cardNumber  String
  cardHolder  String
  expiryMonth Int
  expiryYear  Int
  cardType    String
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model SecurityLog {
  id        String   @id
  userId    String?
  email     String?
  phone     String?
  eventType String
  ipAddress String?
  userAgent String?
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([email])
  @@index([eventType])
  @@index([userId])
}

model SiteConfig {
  id          String   @id
  key         String   @unique
  value       String
  type        String   @default("text")
  description String?
  isPublic    Boolean  @default(false)
  updatedById String?
  updatedAt   DateTime
  User        User?    @relation(fields: [updatedById], references: [id])

  @@index([isPublic])
  @@index([key])
}

model StockMovement {
  id         String   @id
  dataItemId String
  type       String
  quantity   Float
  reason     String?
  orderId    String?
  userId     String?
  notes      String?
  createdAt  DateTime @default(now())
  dataItem   DataItem @relation(fields: [dataItemId], references: [id], onDelete: Cascade)
  User       User?    @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([dataItemId])
  @@index([type])
}

model TestCard {
  id              String            @id
  cardNumber      String            @unique
  cardHolder      String
  expiryMonth     Int
  expiryYear      Int
  cvv             String
  cardType        String
  balance         Float             @default(1000)
  isActive        Boolean           @default(true)
  createdBy       String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  CardTransaction CardTransaction[]

  @@index([cardNumber])
  @@index([isActive])
}

model Transaction {
  id              String   @id
  name            String
  amount          Float
  type            String
  category        String
  description     String?
  date            DateTime @default(now())
  paymentMethod   String?
  isRecurring     Boolean  @default(false)
  recurringPeriod String?
  createdById     String
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@index([category])
  @@index([createdById])
  @@index([date])
  @@index([type])
}

model Translation {
  id          String   @id
  entityType  String
  entityId    String
  field       String
  locale      String
  value       String
  isAutomatic Boolean  @default(true)
  status      String   @default("automatic")
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@unique([entityType, entityId, field, locale])
  @@index([entityType, entityId])
  @@index([locale])
  @@index([status])
}

model UIElement {
  id          String   @id
  type        String
  label       String
  icon        String?
  position    String   @default("floating")
  page        String[]
  order       Int      @default(0)
  size        String   @default("medium")
  color       String   @default("#10B981")
  isVisible   Boolean  @default(true)
  action      String?
  settings    String?
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([createdById])
  @@index([isVisible])
  @@index([order])
  @@index([position])
  @@index([type])
}

model User {
  id                String              @id
  email             String              @unique
  password          String
  name              String
  phone             String?
  address           String?
  avatar            String?
  role              String              @default("user")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  locale            String              @default("ro")
  addressDetails    String?
  city              String?
  county            String?
  street            String?
  streetNumber      String?
  emailVerified     Boolean             @default(false)
  emailVerifiedAt   DateTime?
  CardTransaction   CardTransaction[]
  CarouselItem      CarouselItem[]
  CartItem          CartItem[]
  ChatMessage       ChatMessage[]
  ChatRoom          ChatRoom[]
  ChatRoomMember    ChatRoomMember[]
  DataItem          DataItem[]
  Favorite          Favorite[]
  GiftRule          GiftRule[]
  GiftRuleUsage     GiftRuleUsage[]
  NavigationHistory NavigationHistory[]
  Order             Order[]
  Page              Page[]
  Review            Review[]
  SavedCard         SavedCard[]
  SiteConfig        SiteConfig[]
  StockMovement     StockMovement[]
  UserVoucher       UserVoucher[]
  Voucher           Voucher[]
  VoucherRequest    VoucherRequest[]

  @@index([email])
}

model UserVoucher {
  id        String    @id
  userId    String
  voucherId String
  usedAt    DateTime?
  orderId   String?   @unique
  createdAt DateTime  @default(now())
  Order     Order?    @relation(fields: [orderId], references: [id])
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  Voucher   Voucher   @relation(fields: [voucherId], references: [id], onDelete: Cascade)

  @@unique([userId, voucherId])
  @@index([userId])
  @@index([voucherId])
}

model VerificationCode {
  id          String    @id
  userId      String?
  email       String?
  phone       String?
  type        String
  codeHash    String
  attempts    Int       @default(0)
  maxAttempts Int       @default(3)
  expiresAt   DateTime
  verified    Boolean   @default(false)
  verifiedAt  DateTime?
  invalidated Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([email])
  @@index([expiresAt])
  @@index([invalidated])
  @@index([phone])
  @@index([type])
  @@index([userId])
  @@index([verified])
}

model Voucher {
  id            String        @id
  code          String        @unique
  description   String?
  discountType  String        @default("PERCENTAGE")
  discountValue Float
  minPurchase   Float?
  maxDiscount   Float?
  usedCount     Int           @default(0)
  validFrom     DateTime      @default(now())
  validUntil    DateTime?
  isActive      Boolean       @default(true)
  createdById   String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  maxUsage      Int?
  UserVoucher   UserVoucher[]
  User          User          @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([isActive])
}

model VoucherRequest {
  id            String    @id
  userId        String
  description   String
  status        String    @default("PENDING")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  code          String    @default("REQUESTED")
  discountType  String    @default("PERCENTAGE")
  discountValue Float     @default(10)
  minPurchase   Float?
  validUntil    DateTime?
  User          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
}
